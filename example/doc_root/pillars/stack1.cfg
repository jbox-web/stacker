{# Set base variables #}

{% set roles        = pillar | traverse('my_server:roles', []) %}
{% set roles_config = pillar | traverse('my_server:roles_config', []) %}

{# Include base config #}
01-base/*.yml

{# Include common config #}
02-common/*.yml

{# Include roles #}
{%- for role in roles %}
03-roles/{{ role }}.yml
{%- endfor %}

{# Include roles config #}
{%- for role in roles_config %}
04-roles-config/{{ role }}.yml
{%- endfor %}
